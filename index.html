<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduLink - Your Future Starts Here</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

    <style>
        /* --- Enhanced UI/UX Styles --- */
        :root {
            --primary-blue: #2563eb;
            --primary-indigo: #4f46e5;
            --accent-cyan: #0891b2;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Softer background */
        }
        .page { display: none; }
        .page.active { display: block; }

        /* --- 3D Login Page Styles --- */
        #login-page-container {
            background: linear-gradient(135deg, #1e3a8a, #3b82f6, #818cf8);
            background-size: 400% 400%;
            animation: gradientMove 15s ease infinite;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            perspective: 1200px;
            overflow: hidden;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 100;
        }
        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .shape { position: absolute; border-radius: 50%; opacity: 0.15; filter: blur(2px); animation: float 12s ease-in-out infinite alternate; }
        .shape1 { width: 150px; height: 150px; background: #a5b4fc; top: 10%; left: 5%; animation-delay: 0s; }
        .shape2 { width: 200px; height: 200px; background: #6366f1; bottom: 10%; right: 5%; animation-delay: 3s; }
        @keyframes float { 0% { transform: translateY(0) rotate(0deg) scale(1); } 100% { transform: translateY(-40px) rotate(30deg) scale(1.1); } }
        
        .login-box {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            width: 400px;
            padding: 3rem;
            text-align: center;
            transform-style: preserve-3d;
            transform: rotateY(0deg);
            transition: transform 0.8s cubic-bezier(0.19, 1, 0.22, 1);
        }
        .login-box:hover { transform: rotateY(5deg) scale(1.02); }
        .login-box .role-icon { width: 100px; height: 100px; margin: -80px auto 10px; border-radius: 50%; background: white; padding: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .login-box h2 { font-weight: 800; font-size: 1.75rem; color: #1e293b; }
        .input-group { position: relative; margin-bottom: 1.5rem; }
        .input-group i { position: absolute; top: 50%; left: 15px; transform: translateY(-50%); color: var(--primary-blue); }
        .input-group input, .input-group select { width: 100%; padding: 14px 14px 14px 50px; border: 1px solid #d1d5db; border-radius: 12px; background: #f9fafb; color: #111827; font-size: 1rem; outline: none; transition: all 0.3s ease; }
        .input-group input:focus, .input-group select:focus { border-color: var(--primary-blue); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2); background: white; }
        #login-page-container button[type="submit"] { width: 100%; padding: 16px; background: linear-gradient(90deg, var(--primary-indigo), var(--primary-blue)); color: white; border: none; border-radius: 12px; font-weight: 700; font-size: 1rem; cursor: pointer; box-shadow: 0 10px 25px rgba(79, 70, 229, 0.4); transition: all 0.3s ease; }
        #login-page-container button[type="submit"]:hover { transform: translateY(-3px); box-shadow: 0 15px 30px rgba(79, 70, 229, 0.5); }
        .auth-toggle-link { cursor: pointer; color: var(--primary-indigo); font-weight: 600; margin-top: 1rem; display: inline-block; }
        #auth-message { margin-top: 1rem; font-weight: 500; min-height: 24px; }

        /* --- General App Enhancements --- */
        .toast { transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        @keyframes slideInUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .toast-in { animation: slideInUp 0.5s forwards; }
        .modal-backdrop { background-color: rgba(0,0,0,0.6); }
        .btn-primary { background: var(--primary-blue); color: white; font-weight: 600; padding: 12px 24px; border-radius: 999px; transition: all 0.3s ease; }
        .btn-primary:hover { background: var(--primary-indigo); transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .course-card { transition: all 0.3s ease; }
        .course-card:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
    </style>
</head>
<body>
    
    <!-- 3D Login/Registration Page -->
    <div id="login-page-container" class="page active">
        <div class="shape shape1"></div>
        <div class="shape shape2"></div>
        <div class="login-box">
            <img id="role-icon-img" src="https://i.imgur.com/M5N1s6A.png" alt="Student Icon" class="role-icon">
            <h2 id="auth-title">Welcome to EduLink</h2>
            <form id="auth-form">
                <div class="input-group" id="name-group" style="display: none;">
                    <i class="fa-solid fa-user"></i>
                    <input type="text" id="name" name="name" placeholder="Full Name" />
                </div>
                <div class="input-group">
                    <i class="fa-solid fa-envelope"></i>
                    <input type="email" id="email" name="email" placeholder="Email Address" required />
                </div>
                <div class="input-group">
                    <i class="fa-solid fa-lock"></i>
                    <input type="password" id="password" name="password" placeholder="Password" required />
                </div>
                <div class="input-group" id="role-group" style="display: none;">
                    <i class="fa-solid fa-user-tag"></i>
                    <select id="role" name="role" class="cursor-pointer">
                        <option value="Student">I am a Student</option>
                        <option value="Teacher">I am a Teacher</option>
                        <option value="Parent">I am a Parent</option>
                    </select>
                </div>
                <button type="submit" id="auth-submit-btn">Login</button>
                <p id="auth-message"></p>
                <a id="auth-toggle-link">Don't have an account? Register Now</a>
            </form>
        </div>
    </div>

    <!-- Main Application Container -->
    <div id="main-app-container" class="page">
        <!-- Header -->
        <header id="main-header" class="bg-white/90 backdrop-blur-lg shadow-md sticky top-0 z-50">
            <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
                <a href="#" class="text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-indigo-500 to-blue-500" data-page="home-page">EduLink</a>
                <div class="hidden md:flex items-center space-x-8 font-semibold text-gray-600">
                    <a href="#" class="hover:text-blue-600 transition" data-page="home-page">Home</a>
                    <a href="#" class="hover:text-blue-600 transition" data-page="courses-page">Courses</a>
                    <a href="#" class="hover:text-blue-600 transition hidden" id="dashboard-nav">My Dashboard</a>
                </div>
                <div id="user-section" class="flex items-center space-x-4"></div>
            </nav>
        </header>

        <!-- Dynamic Page Content -->
        <main>
            <div id="home-page" class="page"></div>
            <div id="courses-page" class="page"></div>
            <div id="course-detail-page" class="page"></div>
            <div id="student-dashboard-page" class="page"></div>
            <div id="teacher-dashboard-page" class="page"></div>
            <div id="parent-dashboard-page" class="page"></div>
        </main>
    </div>

    <!-- Global Containers -->
    <div id="modal-container"></div>
    <div id="toast-container" class="fixed bottom-5 right-5 z-[101] w-full max-w-sm"></div>
    <div id="loading-overlay" class="fixed inset-0 bg-white/80 z-[102] hidden items-center justify-center">
        <div class="animate-spin rounded-full h-20 w-20 border-t-4 border-b-4 border-indigo-500"></div>
    </div>

    <script>
        // --- CONFIGURATION & STATE MANAGEMENT ---
        const API_BASE_URL = 'https://edulink-lms.onrender.com';
        const state = {
            currentUser: null, // { name, email, role, token }
            courses: [],
            currentPage: 'home-page',
            isLoginView: true,
        };

        // --- MOCK DATA FOR DEMO ---
        const mockCourses = [
            { _id: '1', title: 'CBSE Class 10 Maths Mastery', description: 'Master the complete CBSE Class 10 mathematics syllabus with interactive lessons.', instructor: 'Priya Sharma', duration: '6 Months', image: 'https://placehold.co/600x400/3b82f6/ffffff?text=Maths', category: 'Maths' },
            { _id: '2', title: 'Python for Beginners', description: 'Build real-world applications from scratch. No prior programming experience needed.', instructor: 'Rohan Verma', duration: '3 Months', image: 'https://placehold.co/600x400/8b5cf6/ffffff?text=Python', category: 'Programming' },
            { _id: '3', title: 'JEE Advanced Physics', description: 'Tackle complex physics problems with proven strategies for the JEE exam.', instructor: 'Dr. Alok Gupta', duration: '1 Year', image: 'https://placehold.co/600x400/ec4899/ffffff?text=Physics', category: 'JEE Prep' },
            { _id: '4', title: 'UPSC History: Ancient to Modern', description: 'A complete guide to Indian History for the UPSC civil services examination.', instructor: 'Anjali Singh', duration: '8 Months', image: 'https://placehold.co/600x400/f97316/ffffff?text=History', category: 'UPSC' },
            { _id: '5', title: 'Complete Guide to Web Development', description: 'Become a full-stack developer. Learn HTML, CSS, JavaScript, Node.js, and more.', instructor: 'Vikram Singh', duration: '9 Months', image: 'https://placehold.co/600x400/10b981/ffffff?text=Web+Dev', category: 'Programming' },
            { _id: '6', title: 'NEET Biology Crash Course', description: 'Score high in NEET with this intensive biology course covering all important topics.', instructor: 'Dr. Sneha Reddy', duration: '4 Months', image: 'https://placehold.co/600x400/22c55e/ffffff?text=Biology', category: 'NEET Prep' },
            { _id: '7', title: 'Mastering English Grammar', description: 'Improve your English fluency and accuracy with this comprehensive grammar guide.', instructor: 'Aditi Desai', duration: '2 Months', image: 'https://placehold.co/600x400/f43f5e/ffffff?text=English', category: 'Language' },
            { _id: '8', title: 'CBSE Class 10 Chemistry', description: 'Understand chemical reactions, acids, bases, and the periodic table with ease.', instructor: 'Rajesh Kumar', duration: '5 Months', image: 'https://placehold.co/600x400/6366f1/ffffff?text=Chemistry', category: 'Science' }
        ];
        
        // --- UTILITIES ---
        const showToast = (message, isError = false) => {
             const toastContainer = document.getElementById('toast-container');
             const toast = document.createElement('div');
             toast.className = `toast p-4 mb-3 rounded-xl shadow-2xl text-white font-semibold ${isError ? 'bg-red-500' : 'bg-green-500'} toast-in`;
             toast.textContent = message;
             toastContainer.appendChild(toast);
             setTimeout(() => toast.remove(), 4000);
        };
        const showLoading = (isLoading) => {
            document.getElementById('loading-overlay').style.display = isLoading ? 'flex' : 'none';
        };

        // --- API CALLS ---
        async function apiRequest(endpoint, method = 'GET', body = null, headers = {}) {
            showLoading(true);
            try {
                const token = localStorage.getItem('edulink_token');
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }
                if (body) {
                    headers['Content-Type'] = 'application/json';
                }
                const response = await fetch(`${API_BASE_URL}/api${endpoint}`, {
                    method,
                    headers,
                    body: body ? JSON.stringify(body) : null
                });
                if (!response.ok) { // Check for non-JSON error responses first
                    const errorText = await response.text();
                    throw new Error(errorText || 'An API error occurred.');
                }
                const data = await response.json();
                if (data.message && response.status !== 200) throw new Error(data.message);
                return data;
            } catch (error) {
                console.error(`API request to ${endpoint} failed:`, error);
                showToast(error.message, true);
                throw error;
            } finally {
                showLoading(false);
            }
        }
        
        // --- CORE APP LOGIC & RENDERING ---
        const navigateTo = (pageId, context = null) => {
            document.querySelectorAll('#main-app-container .page').forEach(p => p.classList.remove('active'));
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
                state.currentPage = pageId;
                window.scrollTo(0, 0);

                switch (pageId) {
                    case 'home-page':
                        renderHomePage();
                        break;
                    case 'courses-page':
                        renderCoursesPage();
                        break;
                    case 'course-detail-page':
                        if (context && context.courseId) {
                            renderCourseDetailPage(context.courseId);
                        }
                        break;
                    case 'student-dashboard-page':
                        renderStudentDashboard();
                        break;
                    case 'teacher-dashboard-page':
                        renderTeacherDashboard();
                        break;
                    case 'parent-dashboard-page':
                        renderParentDashboard();
                        break;
                }
            }
        };

        const updateHeader = () => {
            const userSection = document.getElementById('user-section');
            const dashboardNav = document.getElementById('dashboard-nav');
            if (state.currentUser) {
                userSection.innerHTML = `
                    <span class="font-semibold text-gray-700">Welcome, ${state.currentUser.name}</span>
                    <button id="logout-btn" class="bg-red-500 text-white font-semibold px-4 py-2 rounded-full text-sm hover:bg-red-600 transition">Logout</button>
                `;
                dashboardNav.classList.remove('hidden');
                // Set correct dashboard link based on role
                if (state.currentUser.role === 'Student') dashboardNav.dataset.page = 'student-dashboard-page';
                else if (state.currentUser.role === 'Teacher') dashboardNav.dataset.page = 'teacher-dashboard-page';
                else if (state.currentUser.role === 'Parent') dashboardNav.dataset.page = 'parent-dashboard-page';
            } else {
                userSection.innerHTML = `
                    <button id="login-signup-btn" class="btn-primary">Login / Sign Up</button>
                `;
                dashboardNav.classList.add('hidden');
            }
        };

        const renderCourseCard = (course) => `
            <div class="course-card bg-white rounded-2xl shadow-lg overflow-hidden flex flex-col cursor-pointer" data-course-id="${course._id}" data-page="course-detail-page">
                <img src="${course.image}" alt="${course.title}" class="w-full h-48 object-cover">
                <div class="p-6 flex-grow flex flex-col">
                    <h3 class="font-bold text-xl mb-2 text-gray-800">${course.title}</h3>
                    <p class="text-gray-600 text-sm mb-4 flex-grow">${course.description}</p>
                    <div class="flex justify-between items-center text-sm text-gray-500 pt-4 border-t border-gray-100">
                        <span><i class="fa-solid fa-user-tie mr-2"></i>${course.instructor}</span>
                        <span><i class="fa-solid fa-clock mr-2"></i>${course.duration}</span>
                    </div>
                </div>
            </div>
        `;
        
        // --- AUTHENTICATION LOGIC ---
        const showApp = (shouldShow) => {
            document.getElementById('main-app-container').style.display = shouldShow ? 'block' : 'none';
            document.getElementById('login-page-container').style.display = shouldShow ? 'none' : 'flex';
            if (shouldShow) {
                document.getElementById('main-app-container').classList.add('active');
                navigateTo('home-page');
            }
        };

        const toggleAuthView = () => {
            state.isLoginView = !state.isLoginView;
            const isLogin = state.isLoginView;
            document.getElementById('name-group').style.display = isLogin ? 'none' : 'block';
            document.getElementById('role-group').style.display = isLogin ? 'none' : 'block';
            document.getElementById('auth-title').textContent = isLogin ? 'Welcome Back!' : 'Create Your Account';
            document.getElementById('auth-submit-btn').textContent = isLogin ? 'Login' : 'Register';
            document.getElementById('auth-toggle-link').textContent = isLogin ? "Don't have an account? Register Now" : "Already have an account? Login";
            document.getElementById('auth-message').textContent = '';
            document.getElementById('name').required = !isLogin;
        };

        const handleAuthSubmit = async (e) => {
            e.preventDefault();
            const formData = Object.fromEntries(new FormData(e.target));
            const endpoint = state.isLoginView ? '/auth/login' : '/auth/register';
            try {
                const data = await apiRequest(endpoint, 'POST', formData);
                localStorage.setItem('edulink_token', data.token);
                state.currentUser = { name: data.name, email: data.email, role: data.role, token: data.token };
                showToast(`Welcome, ${data.name}!`, false);
                updateHeader();
                showApp(true);
            } catch (error) {
                document.getElementById('auth-message').textContent = error.message;
                document.getElementById('auth-message').style.color = 'red';
            }
        };

        // --- PAGE RENDERING (NOW FUNCTIONAL) ---
        function renderHomePage() {
            const page = document.getElementById('home-page');
            const featuredCourses = state.courses.slice(0, 4);
            page.innerHTML = `
                <section class="bg-white">
                    <div class="container mx-auto px-6 py-20 text-center">
                        <h1 class="text-5xl md:text-7xl font-extrabold text-gray-800 leading-tight">Your Future Starts Here.</h1>
                        <p class="mt-4 text-xl text-gray-600">Explore limitless learning with expert-led courses on EduLink.</p>
                    </div>
                </section>
                <section class="py-16">
                    <div class="container mx-auto px-6">
                        <h2 class="text-4xl font-bold text-center mb-12">Featured Courses</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                            ${featuredCourses.map(renderCourseCard).join('')}
                        </div>
                    </div>
                </section>
            `;
        }

        function renderCoursesPage() {
            const page = document.getElementById('courses-page');
            page.innerHTML = `
                <section class="py-16">
                    <div class="container mx-auto px-6">
                        <h2 class="text-4xl font-bold text-center mb-12">All Courses</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                            ${state.courses.map(renderCourseCard).join('')}
                        </div>
                    </div>
                </section>
            `;
        }

        function renderCourseDetailPage(courseId) {
            const page = document.getElementById('course-detail-page');
            const course = state.courses.find(c => c._id === courseId);
            if (!course) {
                page.innerHTML = `<p class="text-center py-20">Course not found.</p>`;
                return;
            }
            page.innerHTML = `
                <section class="py-16 bg-white">
                    <div class="container mx-auto px-6">
                        <div class="lg:flex gap-12">
                            <div class="lg:w-2/3">
                                <h1 class="text-4xl font-extrabold mb-2">${course.title}</h1>
                                <p class="text-lg text-gray-600 mb-6">By ${course.instructor}</p>
                                <img src="${course.image}" alt="${course.title}" class="rounded-2xl shadow-xl w-full object-cover mb-8">
                                <h2 class="text-2xl font-bold mb-4">About This Course</h2>
                                <p class="text-gray-700 leading-relaxed">${course.description}</p>
                            </div>
                            <div class="lg:w-1/3 mt-8 lg:mt-0">
                                <div class="bg-gray-50 p-6 rounded-2xl shadow-inner">
                                    <h3 class="text-2xl font-bold mb-6">Course Features</h3>
                                    <button class="w-full btn-primary text-lg">Enroll Now</button>
                                    <!-- Additional details can go here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            `;
        }

        function renderStudentDashboard() { document.getElementById('student-dashboard-page').innerHTML = `<h1 class="text-center py-20 text-3xl font-bold">Student Dashboard (Coming Soon)</h1>`; }
        function renderTeacherDashboard() { document.getElementById('teacher-dashboard-page').innerHTML = `<h1 class="text-center py-20 text-3xl font-bold">Teacher Dashboard (Coming Soon)</h1>`; }
        function renderParentDashboard() { document.getElementById('parent-dashboard-page').innerHTML = `<h1 class="text-center py-20 text-3xl font-bold">Parent Dashboard (Coming Soon)</h1>`; }
        
        // --- INITIALIZATION & EVENT LISTENERS ---
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const courseData = await apiRequest('/courses');
                state.courses = courseData.courses || mockCourses;
            } catch (error) {
                console.log("Using mock data as API failed.");
                state.courses = mockCourses;
            }
            const token = localStorage.getItem('edulink_token');
            if (token) {
                try {
                    const payload = JSON.parse(atob(token.split('.')[1]));
                    state.currentUser = { name: payload.name, email: payload.email, role: payload.role, token };
                    showApp(true);
                } catch {
                     localStorage.removeItem('edulink_token');
                     showApp(false);
                }
            } else {
                showApp(false);
            }
            updateHeader();
        });

        document.getElementById('auth-form').addEventListener('submit', handleAuthSubmit);
        document.getElementById('auth-toggle-link').addEventListener('click', (e) => { e.preventDefault(); toggleAuthView(); });
        document.getElementById('role').addEventListener('change', (e) => {
            const roleIcons = {
                Student: 'https://i.imgur.com/M5N1s6A.png', // student icon
                Teacher: 'https://i.imgur.com/ODS6lW4.png', // teacher icon
                Parent: 'https://i.imgur.com/sC50d2C.png'   // parent icon
            };
            document.getElementById('role-icon-img').src = roleIcons[e.target.value];
        });

        document.body.addEventListener('click', (e) => {
            const pageTarget = e.target.closest('[data-page]');
            if (pageTarget) {
                e.preventDefault();
                navigateTo(pageTarget.dataset.page, { courseId: pageTarget.dataset.courseId });
            }
            if (e.target.matches('#logout-btn')) {
                localStorage.removeItem('edulink_token');
                state.currentUser = null;
                updateHeader();
                showApp(false);
            }
        });
    </script>
</body>
</html>

